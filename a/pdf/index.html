<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>PDF Viewer with Tabs</title>
    <link rel="stylesheet" type="text/css" href="./lib/UIExtension.css">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            height: 100vh;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        .sidebar {
            width: 25%;
            background: #f4f4f4;
            padding: 15px;
            overflow-y: auto;
            border-right: 2px solid #ddd;
            flex-shrink: 0;


        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            padding: 10px 0;
            cursor: pointer;
            /* transition: background 0.3s; */
        }



        .pdf-viewer {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        #tabHeaders {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            border-bottom: 2px solid #ccc;
            padding: 10px;
            max-width: 80%;
            /* scrollbar-width: thin; */
        }

        #tabHeaders::-webkit-scrollbar {
            height: 8px;
        }

        #tabHeaders::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .tab {
            padding: 10px 20px;
            margin-right: 10px;
            background: #ecf0f1;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .tab.active {
            background: #3498db;
            color: white;
        }

        .close-btn {
            margin-left: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        /* #pdf-ui {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
        } */

        #pdf-ui {
            overflow-y: auto;
            flex-grow: 1;
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            padding: 20px;
        }


        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
            display: none;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        #categoryList {
            margin-top: 20px;
        }

        /* Tree styling */
        .tree {
            list-style-type: none;
            padding-left: 20px;
        }

        .tree li {
            margin: 5px 0;
        }

        #sidebar ul {
            margin: 0;
            padding-left: 20px;
            list-style: none;
            line-height: 2em;
        }

        #sidebar ul li {
            position: relative;
        }

        #sidebar ul li::before,
        #sidebar ul li::after {
            content: "";
            position: absolute;
            left: -15px;
            border-left: 2px dashed #999;
        }

        #sidebar ul li::before {
            top: 0;
            width: 15px;
            height: 1em;
            border-bottom: 2px dashed #999;
        }

        #sidebar ul.tree>li:first-child::before {
            border-left: none;
        }

        #sidebar ul li::after {
            top: 1.1em;
            bottom: 1px;
        }

        #sidebar ul li:last-child::after {
            display: none;
        }

        .bxs-file-pdf {
            color: gray;
            /* PDF icon color */
            margin-right: 5px;
        }
    </style>
</head>

<body>

    <div class="sidebar" id="sidebar">
        <img src="logo.png" alt="Logo" style="width: 30%;">
        <div id="loadingSpinner" class="loading-spinner"></div>
        <ul class="tree" id="categoryList"></ul>
    </div>

    <div class="pdf-viewer">
        <div id="tabHeaders"></div>

        <div id="pdf-ui">
            <p>Select a category to open a tab.</p>
        </div>
    </div>

    <script src='./lib/UIExtension.full.js'></script>
    <!-- <script src="./lib/uix-addons/allInOne.js"></script> -->
    <script src="./lib/preload-jr-worker.js"></script>



    <script>
        var licenseSN = "Ha9BlquKQEl20b3P2ooT3jj8LKqzoH1sZuACM3FjMlVe6YKaoEOPKw==";
        var licenseKey = "PjwcmDawOS6sb7uJGyG8Al6vUyI3//xDk+VFrCYslVqDFBbyOT5ekCYU8EpIukjLLeiZcinAVzlxr9K+NbG5ErBU/cpVkXnSYr001iVW8IJI4t/9PwhCXFY09aXIhJfK7bUF/j5g1sLyFaEwTtk+2TV2GD/AidLswJuqH24pzzMF1voM4XjYwkASb0qegFdmRhaZRaJFPFsI/9E4JCNYtX1sAEd6drDCbljeXp9htVcDjLLJNBT5APLoWdDUOusSex+cUnJcKPt+h/33bYsUHvCok0zbOSXCxR3zczHzRNv5kluEA9n55cdAGK9xdNAV4FzTNuAaFfUH93cpy2da1EmNTrRyJt3FsnFkXydSMNWaMtxyIfl3zgNLB1bBsIRuQEy2kMH2hwQk2PrBQP2JFPocrTz3SEe3FYTTsD3N1N5eVpQb33JhVGRb/NyE857G9eRFx2zvHFeTVM64M2WrxrizVGAmVlKXAU56/oDw/E5/gHIwyQSnn4xgiEMhG3ST/h0uklIyV4OpPmC+90jIyiEZZTIRht8vTVD2H0U2zhLu3+86LaR3pyuxVmrgg8WaZE3PETdxM11d2WA/jvrAaMZCknohUKC+x749QVO64mTfn+QUIE++8GjPIB27hJey9+lP1ahZlZqDJBH21baeaPwIoqIRGjRTYmgNeWAh+8ijpIv3WtQR+4lUSOQm98UYaPajnEO4thMQu5JaUcoVaq3D+u4OadCefLPU2W6MCsxj4GFKuu3wkuRmuExPOoF3ykDe2H6SU8B3Sn/HPmg8ADoArpwyLTLlhXnC+Gnd6h7NLdgdEjm0yTVkHigtEepylsQnG7VAlgOVIAaJyauFB9i2IU96x/oOwCIygkOwWf+V1AaR+zJLAt0cUcmoKOOvYnkLeWfLtfSwoJfO720UiRKtIbp0wNc7DCz2f7hrUOkEnMV7kvFUpJ3ZzGfgD5671WHcvhdFl572ZutAgfOjjdHexk/N534Wh3QHt3Yxyh6CLIkspxN4qmx5gzVck0LqXN4/DYGexoMGQveY9SJCicBQFnE6txH4tfzJ4gSXadcxlBvEaPe0qu+M7jDMPqlzfhjPWUE5CSx43SA9PZbBESS4EiCHvgVDfoioFhlLIe93a0StPBNKZxHTspTj7q0DOvlKy+rvuO4GaRp8Jiqoqhfitn4+DB3CjHed8f1/61kDVwLKTWyw5Hzm7u+JHrD4r4sw9hThsisSo9e0dqHCuyafjdYdF89EB4ECKOLveG4=";
        var pdfui = new UIExtension.PDFUI({
            viewerOptions: {
                libPath: './lib',
                jr: {
                    // readyWorker: readyWorker,
                    licenseSN: licenseSN,
                    licenseKey: licenseKey
                },
            },
            renderTo: '#pdf-ui',
            addons: [
                "./lib/uix-addons/search",
                // "./lib/uix-addons/print",

            ],
        });

    </script>

    <script>



        function renderCategories(categories, parentElement) {
            categories.forEach((category) => {
                const li = document.createElement('li');
                li.setAttribute('data-name', category.name.toLowerCase());

                // Create a span for category name or PDF link
                const span = document.createElement('span');
                span.textContent = category.name;

                if (category.pdfs && category.pdfs.length > 0) {
                    // Ensure the PDF icon and clickable span are rendered correctly
                    span.innerHTML = `
                        <i class="bx bxs-file-pdf"></i> 
                        ${category.name}
                    `;
                    span.style.cursor = 'pointer';
                    span.onclick = () => openTab(category.pdfs[0].pdf, category.id);
                }

                // Create a container for children (if any)
                const childContainer = document.createElement('ul');
                childContainer.style.display = 'none'; // Initially hide children

                // If there are children, add an expand/collapse toggle
                if (category.children && category.children.length > 0) {
                    const toggleIcon = document.createElement('span');
                    toggleIcon.textContent = '▶'; // Collapsed icon
                    toggleIcon.style.cursor = 'pointer';
                    toggleIcon.style.marginRight = '5px';

                    // Expand/Collapse logic
                    toggleIcon.addEventListener('click', () => {
                        if (childContainer.style.display === 'none') {
                            childContainer.style.display = 'block';
                            toggleIcon.textContent = '▼'; // Expanded icon
                        } else {
                            childContainer.style.display = 'none';
                            toggleIcon.textContent = '▶'; // Collapsed icon
                        }
                    });

                    li.appendChild(toggleIcon);
                }

                li.appendChild(span);

                // Recursively render children
                if (category.children && category.children.length > 0) {
                    renderCategories(category.children, childContainer);
                    li.appendChild(childContainer);
                }

                parentElement.appendChild(li);
            });
        }




        function openTab(pdfUrl, tabId) {
            console.log(`Opening PDF: ${pdfUrl} with ID: ${tabId}`);
            const tabHeaders = document.getElementById('tabHeaders');
            const pdfUI = document.getElementById('pdf-ui');

            const existingTab = document.querySelector(`.tab[data-tab-id="${tabId}"]`);
            if (existingTab) {
                switchTab(tabId);
                return;
            }

            const newTab = document.createElement('div');
            newTab.className = 'tab';
            newTab.setAttribute('data-tab-id', tabId);
            newTab.innerHTML = `<span class="close-btn" onclick="closeTab(event, '${tabId}')">✕</span>`;
            newTab.addEventListener('click', () => switchTab(tabId));
            tabHeaders.appendChild(newTab);

            const tabContent = document.createElement('div');
            tabContent.setAttribute('data-tab-id', tabId);
            tabContent.style.display = 'none';
            tabContent.innerHTML = `<h2>${pdfUrl}</h2>`;
            pdfUI.appendChild(pdfUrl);

            switchTab(tabId);

            tabHeaders.scrollLeft = tabHeaders.scrollWidth;
        }


        // Open PDF in a new tab (or Electron window if required)
        // function openTab(pdfUrl, identifier) {
        //     // Ensure the pdfUrl is properly inserted into the URL string
        //     loadPDFFromURL(`https://skillbypm.com/public/${pdfUrl}`);

        //     console.log(`Opening PDF: ${pdfUrl} with ID: ${identifier}`);

        // }






        // Fetch and display categories in the sidebar
        async function loadCategories() {
            const loadingSpinner = document.getElementById('loadingSpinner');
            loadingSpinner.style.display = 'block';  // Show the loading spinner inside sidebar

            try {
                const response = await fetch('https://skillbypm.com/api/categories.php');
                const data = await response.json();

                if (data.status === 'success' && data.categories.length > 0) {
                    const treeContainer = document.getElementById('categoryList');
                    renderCategories(data.categories, treeContainer);
                } else {
                    console.error('No categories available or error fetching categories:', data.message);
                    const treeContainer = document.getElementById('categoryList');
                    treeContainer.innerHTML = '<li>No categories available</li>';
                }
            } catch (error) {
                console.error('Network error:', error);
                const treeContainer = document.getElementById('categoryList');
                treeContainer.innerHTML = '<li>Error loading categories. Please try again later.</li>';
            } finally {
                loadingSpinner.style.display = 'none';  // Hide the loading spinner after data is loaded
            }
        }

        // Load categories on page load
        document.addEventListener('DOMContentLoaded', loadCategories);


        // const categories = Array.from({ length: 50 }, (_, i) => ({ id: i + 1, name: `Tab ${i + 1}` }));

        // function loadCategories() {
        //     const categoryList = document.getElementById('categoryList');
        //     categories.forEach(category => {
        //         const li = document.createElement('li');
        //         li.textContent = category.name;
        //         li.onclick = () => openTab(category.name, category.id);
        //         categoryList.appendChild(li);
        //     });
        // }

        // function openTab(content, tabId) {
        //     const tabHeaders = document.getElementById('tabHeaders');
        //     const pdfUI = document.getElementById('pdf-ui');

        //     const existingTab = document.querySelector(`.tab[data-tab-id="${tabId}"]`);
        //     if (existingTab) {
        //         switchTab(tabId);
        //         return;
        //     }

        //     const newTab = document.createElement('div');
        //     newTab.className = 'tab';
        //     newTab.setAttribute('data-tab-id', tabId);
        //     newTab.innerHTML = `${content} <span class="close-btn" onclick="closeTab(event, '${tabId}')">✕</span>`;
        //     newTab.addEventListener('click', () => switchTab(tabId));
        //     tabHeaders.appendChild(newTab);

        //     const tabContent = document.createElement('div');
        //     tabContent.setAttribute('data-tab-id', tabId);
        //     tabContent.style.display = 'none';
        //     tabContent.innerHTML = `<h2>${content}</h2>`;
        //     pdfUI.appendChild(tabContent);

        //     switchTab(tabId);

        //     tabHeaders.scrollLeft = tabHeaders.scrollWidth;
        // }

        function switchTab(tabId) {
            document.querySelectorAll('#pdf-ui > div').forEach(tab => tab.style.display = 'none');

            const activeTabContent = document.querySelector(`#pdf-ui > div[data-tab-id="${tabId}"]`);
            if (activeTabContent) activeTabContent.style.display = 'block';

            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));

            const activeTab = document.querySelector(`.tab[data-tab-id="${tabId}"]`);
            if (activeTab) activeTab.classList.add('active');
        }

        function closeTab(event, tabId) {
            event.stopPropagation();

            document.querySelector(`.tab[data-tab-id="${tabId}"]`)?.remove();
            document.querySelector(`#pdf-ui > div[data-tab-id="${tabId}"]`)?.remove();

            const lastTab = document.querySelector('.tab:last-child');
            if (lastTab) switchTab(lastTab.getAttribute('data-tab-id'));
            else document.getElementById('pdf-ui').innerHTML = '<p>Select a category to open a tab.</p>';
        }

        // document.addEventListener('DOMContentLoaded', loadCategories);






    </script>






</body>

</html>